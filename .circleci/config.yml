version: 2.1
jobs:
  build:
    docker:
      - image: circleci/python:latest
        auth:
          username: $DOCKERHUB_USERNAME
          password: $DOCKERHUB_PASSWORD
    working_directory: ~/circleci-dockerhook
    steps:
      - checkout
      - run: git submodule sync
      - run: git submodule update --init

      - run:
          name: Configure
          command: |
            mkdir -v      .env
            echo abc123 > .env/DOCKERHOOK_TOKEN
      - run:
          name: Install
          command: |
            sudo addgroup docker
            sudo ./install.sh
      - run:
          name: Activate
          command: |
            sudo ./activate.sh
      - run:
          name: Uninstall
          command: |
            sudo ./uninstall.sh
#      - run:
#          name: Notify DockerHub
#          command: |
#            curl -X POST "$DOCKERHUB_TRIGGER"

workflows:
  version: 2
  build:
    jobs:
      - build:
          filters:
            branches:
              ignore: gh-pages
